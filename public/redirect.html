<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>安全中心 | 5M茶馆</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        user-select: none;
        box-sizing: border-box;
      }

      :root {
        --main-site-background: #f7f9fe;
        --main-card-border: #e3e8f7;
        --main-card-background: #fff;
        --main-font-color: #363636;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --main-site-background: #18171d;
          --main-card-border: #3d3d3f;
          --main-card-background: #1b1c20;
          --main-font-color: #f7f7fa;
        }
      }

      a {
        text-decoration: none;
        color: var(--main-font-color);
      }

      body {
        background-color: var(--main-site-background);
        color: var(--main-font-color);
        font-family: "PingFang SC", "Open Sans", "Microsoft YaHei", sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        width: 100vw;
        width: 100dvw;
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
        transition:
          color 0.3s,
          background-color 0.3s;
      }

      header {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      header .logo img {
        width: 100px;
        height: 100px;
        margin-bottom: 20px;
      }

      header .title {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      header .title .site-name {
        font-size: 30px;
        font-weight: bold;
      }

      header .title .site-tip {
        font-size: 20px;
        margin-top: 8px;
        opacity: 0.6;
      }

      main {
        margin: 30px 20px 60px;
        border-radius: 16px;
        padding: 30px;
        max-width: 768px;
        min-width: 380px;
        background-color: var(--main-card-background);
        border: 1px solid var(--main-card-border);
      }

      main .tip {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
        opacity: 0.4;
      }

      main #url {
        display: block;
        padding: 12px 20px;
        border-radius: 8px;
        width: 100%;
        text-align: center;
        border: 1px solid var(--main-card-border);
        background-color: var(--main-site-background);
      }

      main #site-info {
        display: inline-flex;
        width: 100%;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        margin-top: 20px;
        font-size: 18px;
      }

      main #jump-content {
        color: #00d26a;
      }

      main #jump-button {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 44px;
        width: 160px;
        margin: 30px auto 0;
        border-radius: 8px;
        color: var(--main-font-color);
        background-color: var(--main-card-border);
        transition: background-color 0.3s;
        cursor: pointer;
      }

      main #jump-button:hover {
        background-color: var(--main-site-background);
      }

      footer {
        width: 100%;
        text-align: center;
        position: absolute;
        bottom: 0;
        margin: 20px;
        opacity: 0.6;
        font-size: 15px;
      }
    </style>
  </head>

  <body>
    <header>
      <div class="logo">
        <img src="./images/logo/logo.webp" alt="" />
      </div>
      <div class="title">
        <span class="site-name">5M茶馆</span>
        <span class="site-tip">安全中心</span>
      </div>
    </header>
    <main>
      <span class="tip">您即将离开[5M茶馆]，前往</span>
      <span id="url"></span>
      <div id="jump-content">
        <span id="site-info">即将跳转至目标网址</span>
        <div id="jump-button">继续前往</div>
      </div>
    </main>
    <footer>
      <a class="power" href="https://5um3rM0.github.io/">
        ©
        <script>
          document.write(new Date().getFullYear());
        </script>
        5M茶馆
      </a>
    </footer>
    <script>
      // 跳转网址
      let jumpLink;
      let interval;
      // 获取元素
      const urlDom = document.getElementById("url");
      const urlTip = document.getElementById("site-info");
      const jumpContent = document.getElementById("jump-content");
      const jumpButton = document.getElementById("jump-button");

      // 自动跳转（1秒后）
      const autoJump = () => {
        let count = 3;
        const updateContent = () => {
          jumpButton.innerHTML = `${count} 秒后自动跳转`;
          count--;
          if (count < 0) {
            clearInterval(interval);
            jumpButton.innerHTML = "正在跳转";
            window.location.replace(jumpLink);
          }
        };
        // 立即更新一次，随后每秒更新
        updateContent();
        interval = setInterval(updateContent, 1000);
      };

      // 获取跳转网址
      const getJumpUrl = () => {
        try {
          const urlParams = new URLSearchParams(window.location.search);
          const encodedUrl = urlParams.get("url");

          // 如果没有url参数，显示提示文字，不报错
          if (!encodedUrl) {
            urlDom.innerHTML = "未指定跳转网址"; // 替换“乱码”为明确提示
            jumpButton.innerHTML = "无法跳转"; // 按钮状态改为“无法跳转”
            jumpButton.style.cursor = "not-allowed";
            jumpButton.style.opacity = "0.4";
            return; // 停止后续逻辑
          }

          // 有参数时再解码跳转
          jumpLink = atob(encodedUrl);
          urlDom.innerHTML = jumpLink;
          autoJump();
        } catch (error) {
          console.error(error);
          urlDom.innerHTML = "跳转链接格式错误"; // 明确错误提示
          jumpButton.innerHTML = "无法跳转";
          jumpButton.style.cursor = "not-allowed";
          jumpButton.style.opacity = "0.4";
        }
      };

      // 禁止右键和F12等开发者工具快捷键
      document.addEventListener("contextmenu", function (event) {
        event.preventDefault();
      });
      document.addEventListener("keydown", function (event) {
        if (event.keyCode === 123) {
          event.preventDefault();
        }
        if (
          event.ctrlKey &&
          event.shiftKey &&
          (event.keyCode === 73 || event.keyCode === 74 || event.keyCode === 67)
        ) {
          event.preventDefault();
        }
      });

      // 点击按钮手动跳转
      jumpButton.addEventListener("click", () => {
        clearInterval(interval);
        jumpButton.innerHTML = "正在跳转";
        if (jumpLink) window.location.replace(jumpLink);
      });

      // 页面加载完成后获取跳转链接
      window.addEventListener("DOMContentLoaded", () => {
        getJumpUrl();
      });
    </script>
  </body>
</html>
